!function(o){"undefined"==typeof Spoon&&(Spoon={}),Spoon.GroupsDesigner=Craft.FieldLayoutDesigner.extend({$form:null,$spinner:null,modal:null,initElement:function(t){new Craft.FieldLayoutDesigner.Element(this,t);var i=o("<a/>",{role:"button",tabindex:0,class:"settings icon",title:Craft.t("app","Edit")});i.on("click",o.proxy(function(){this.onEditFieldLayout(t)},this)),i.appendTo(t)},renameTab:function(t){if(this.settings.customizableTabs){var i=t.find(".tabs .tab span"),e=i.text(),s=prompt(Craft.t("app","Give your group a name."),e);s&&s!==e&&(i.text(s),t.find(".placement-input").attr("name",this.getElementPlacementInputName(s)))}},addTab:function(){if(this.settings.customizableTabs){var t=o('<div class="fld-tab"><div class="tabs"><div class="tab sel draggable"><span>Group '+(this.tabGrid.$items.length+1)+'</span><a class="settings icon" title="'+Craft.t("app","Rename")+'"></a></div></div><div class="fld-tabcontent"></div></div>').appendTo(this.$tabContainer);this.tabGrid.addItems(t),this.tabDrag.addItems(t),this.initTab(t)}},onEditFieldLayout:function(t){var i=t.parents(".modal");i.one("blockTypesSaved",o.proxy(function(){this.editFieldLayout(t)},this)),i.trigger("submit")},editFieldLayout:function(i){this.$form=o('<form class="modal elementselectormodal spoon-fields-configurator"/>');var e=o('<div class="body"/>').appendTo(this.$form),s=(e=o('<div class="content"/>').appendTo(e),o('<div class="spinner big"/>').appendTo(e)),t=(e=o('<div class="main"/>').appendTo(e),o('<div class="footer"/>').appendTo(this.$form)),a=o('<div class="buttons right"/>').appendTo(t);this.$spinner=o('<div class="spinner hidden"/>').appendTo(a);var n=o('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(a);o('<input type="submit" class="btn submit" value="'+Craft.t("app","Save")+'"/>').appendTo(a);this.modal=new Garnish.Modal(this.$form,{resizable:!0,closeOtherModals:!1,onFadeIn:o.proxy(function(){var t={context:this.settings.context,blockTypeId:i.data("id")};Craft.postActionRequest("spoon/configurator/get-fields-html",t,o.proxy(function(t,i){if("success"==i){o(t.html).appendTo(e),s.addClass("hidden");new Craft.FieldLayoutDesigner("#spoon-fields-configurator",{customizableTabs:!0,customizableUi:!1})}},this))},this),onHide:o.proxy(function(){this.modal.$container.remove(),this.modal.$shade.remove()},this)}),this.addListener(this.$form,"submit","_handleSubmit"),this.addListener(n,"click",o.proxy(function(){this.modal.hide()},this))},_handleSubmit:function(t){t.preventDefault(),this.$spinner.removeClass("hidden");var i=this.$form.serialize();Craft.postActionRequest("spoon/block-types/save-field-layout",i,o.proxy(function(t,i){this.$spinner.addClass("hidden"),"success"==i&&t.success?(Craft.cp.displayNotice(Craft.t("app","Field layout saved.")),this.modal.hide()):"success"==i&&Craft.cp.displayError(Craft.t("app","An unknown error occurred."))},this))}})}(jQuery);